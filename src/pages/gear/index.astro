---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts', ({ data }) => data.category === 'gear');

const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf()
);

// Group by hub if available
const hubGroups: Record<string, typeof posts> = {};
const noHub: typeof posts = [];

sortedPosts.forEach(post => {
  if (post.data.hub) {
    if (!hubGroups[post.data.hub]) {
      hubGroups[post.data.hub] = [];
    }
    hubGroups[post.data.hub].push(post);
  } else {
    noHub.push(post);
  }
});

const hubNames: Record<string, string> = {
  'bug-out-bag': 'Bug Out Bag Gear',
  'get-home-bag': 'Get Home Bag Gear',
  'water-preparedness': 'Water Preparedness',
  'emergency-power': 'Emergency Power',
  'food-storage': 'Food Storage',
  'home-emergency-kit': 'Home Emergency Kit',
  'vehicle-preparedness': 'Vehicle Preparedness',
};
---

<BaseLayout
  title="Gear Reviews & Recommendations"
  description="In-depth reviews and recommendations for survival gear, emergency equipment, and preparedness tools. Find the best gear for your needs and budget."
>
  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-12">
    <!-- Header -->
    <div class="mb-12">
      <h1 class="text-4xl font-bold text-stone-900 mb-4">Gear Reviews</h1>
      <p class="text-xl text-stone-600 max-w-3xl">
        In-depth reviews and recommendations for emergency preparedness gear. We research extensively to find the best options at every price point.
      </p>
    </div>

    <!-- All Gear Posts -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {sortedPosts.map((post) => (
        <article class="bg-white border border-stone-200 rounded-xl overflow-hidden hover:shadow-md transition-shadow">
          <a href={`/gear/${post.slug}/`} class="block p-6">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-xs font-medium px-2 py-1 rounded bg-rust-100 text-rust-800">
                {post.data.contentType === 'roundup' ? 'Roundup' : 'Review'}
              </span>
              {post.data.hub && (
                <span class="text-xs font-medium px-2 py-1 rounded bg-stone-100 text-stone-600">
                  {post.data.hub.replace(/-/g, ' ')}
                </span>
              )}
            </div>
            <h3 class="text-lg font-semibold text-stone-900 mb-2 hover:text-forest-700 transition-colors">
              {post.data.title}
            </h3>
            <p class="text-stone-600 text-sm line-clamp-2">
              {post.data.description}
            </p>
            {post.data.hasAffiliateLinks && (
              <p class="mt-3 text-xs text-stone-500">
                Contains affiliate links
              </p>
            )}
          </a>
        </article>
      ))}
    </div>

    {sortedPosts.length === 0 && (
      <p class="text-stone-600 text-center py-12">No gear reviews available yet. Check back soon!</p>
    )}
  </main>
</BaseLayout>
