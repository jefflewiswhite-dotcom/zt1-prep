---
interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings: Heading[];
  collapsible?: boolean;
}

const { headings, collapsible = false } = Astro.props;

// Only show h2 and h3
const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <nav
    class:list={[
      'toc',
      collapsible ? 'bg-stone-50 rounded-lg p-4' : '',
    ]}
    aria-label="Table of Contents"
  >
    {collapsible ? (
      <details class="group">
        <summary class="cursor-pointer list-none flex items-center justify-between font-semibold text-stone-900">
          <span>Table of Contents</span>
          <svg class="w-5 h-5 text-stone-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </summary>
        <ul class="mt-4 space-y-2">
          {filteredHeadings.map((heading) => (
            <li class:list={[heading.depth === 3 ? 'ml-4' : '']}>
              <a
                href={`#${heading.slug}`}
                class="block text-sm text-stone-600 hover:text-forest-700 transition-colors py-1"
              >
                {heading.text}
              </a>
            </li>
          ))}
        </ul>
      </details>
    ) : (
      <>
        <p class="font-semibold text-stone-900 mb-4 text-sm uppercase tracking-wide">On This Page</p>
        <ul class="space-y-2 border-l-2 border-stone-200">
          {filteredHeadings.map((heading) => (
            <li class:list={[heading.depth === 3 ? 'ml-2' : '']}>
              <a
                href={`#${heading.slug}`}
                class="block text-sm text-stone-500 hover:text-forest-700 transition-colors py-1 pl-4 -ml-[2px] border-l-2 border-transparent hover:border-forest-500"
              >
                {heading.text}
              </a>
            </li>
          ))}
        </ul>
      </>
    )}
  </nav>
)}
